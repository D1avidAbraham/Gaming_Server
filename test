# Use an official Ubuntu base image
FROM ubuntu:22.04

# Arguments for non-root user
ARG USER=appuser
ARG UID=1000
ARG GID=1000

# Create non-root user
RUN groupadd -g ${GID} ${USER} \
    && useradd -m -u ${UID} -g ${GID} -s /bin/bash ${USER}

# Switch to user
WORKDIR /home/${USER}
USER ${USER}

# Install dependencies and enable i386
RUN sudo apt-get update \
    && sudo DEBIAN_FRONTEND=noninteractive apt-get install -y --no-install-recommends \
       wget \
       fuse \
       software-properties-common \
    && sudo dpkg --add-architecture i386 \
    && sudo apt-get update \
    && sudo DEBIAN_FRONTEND=noninteractive apt-get install -y --no-install-recommends \
       steam \
    && sudo rm -rf /var/lib/apt/lists/*

# Download, install, and clean up Sunshine AppImage
RUN wget https://github.com/LizardByte/Sunshine/releases/latest/download/sunshine.AppImage \
    && chmod +x sunshine.AppImage \
    && ./sunshine.AppImage --install \
    && rm sunshine.AppImage

# Optional: expose ports or mount volumes for Steam/Sunshine
# EXPOSE 27015 27020
# VOLUME ["/home/appuser/.steam", "/home/appuser/.config"]

# Default command (adjust if needed)
CMD ["bash"]
